<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Agency Particles</title>
<meta name="viewport" content="width=device-width,initial-scale=1">

<script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>

<style>
body{
  margin:0;
  background:#0b0c12;
  color:#fff;
  font-family:Inter,system-ui,sans-serif;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:100px 20px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:60px;
}
.cards{
  display:grid;
  gap:20px;
}
.card{
  background:#13152a;
  padding:26px;
  border-radius:16px;
  cursor:pointer;
}
.card:hover{background:#1b1f44}
.card h3{margin:0 0 6px}
#stage{height:440px}
@media(max-width:900px){
  .container{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="container">
  <div class="cards">
    <div class="card" onmouseenter="iconBars()" onmouseleave="scatter()">
      <h3>GTM Strategy</h3>
      <p>Growth & analytics</p>
    </div>
    <div class="card" onmouseenter="iconCube()" onmouseleave="scatter()">
      <h3>Product Design</h3>
      <p>UX & systems</p>
    </div>
    <div class="card" onmouseenter="iconText()" onmouseleave="scatter()">
      <h3>Development</h3>
      <p>Scalable platforms</p>
    </div>
  </div>

  <div id="stage"></div>
</div>

<script>
/* ===== THREE CORE ===== */
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(60,1,0.1,1000);
camera.position.z=6;

const renderer=new THREE.WebGLRenderer({alpha:true,antialias:true});
renderer.setSize(440,440);
renderer.setPixelRatio(devicePixelRatio);
document.getElementById("stage").appendChild(renderer.domElement);

window.addEventListener("resize",()=>{
  const s=document.getElementById("stage").clientWidth;
  renderer.setSize(s,s);
});

/* ===== PARTICLES ===== */
const COUNT=2000;
const geo=new THREE.BufferGeometry();
const pos=new Float32Array(COUNT*3);
const target=new Float32Array(COUNT*3);

for(let i=0;i<COUNT;i++){
  pos[i*3]=(Math.random()-0.5)*10;
  pos[i*3+1]=(Math.random()-0.5)*10;
  pos[i*3+2]=(Math.random()-0.5)*10;
}
geo.setAttribute("position",new THREE.BufferAttribute(pos,3));

const mat=new THREE.PointsMaterial({
  size:0.045,
  color:0x7b7bff,
  transparent:true,
  opacity:0.85,
  blending:THREE.AdditiveBlending
});

const pts=new THREE.Points(geo,mat);
scene.add(pts);

/* ===== OFFSCREEN CANVAS ===== */
const c=document.createElement("canvas");
c.width=240;c.height=240;
const ctx=c.getContext("2d");

/* ===== UTILS ===== */
function applyCanvas(step=4){
  const img=ctx.getImageData(0,0,240,240).data;
  let i=0;
  for(let y=0;y<240;y+=step){
    for(let x=0;x<240;x+=step){
      if(i>=COUNT) break;
      const a=img[(y*240+x)*4+3];
      if(a>200){
        target[i*3]=(x-120)/18;
        target[i*3+1]=(120-y)/18;
        target[i*3+2]=Math.sin(i)*0.4;
        i++;
      }
    }
  }
}

/* ===== ICONS ===== */
function iconBars(){
  ctx.clearRect(0,0,240,240);
  ctx.fillStyle="#fff";
  ctx.fillRect(50,110,22,80);
  ctx.fillRect(100,80,22,110);
  ctx.fillRect(150,50,22,140);
  applyCanvas();
}

function iconCube(){
  ctx.clearRect(0,0,240,240);
  ctx.strokeStyle="#fff";
  ctx.lineWidth=4;
  ctx.strokeRect(60,60,100,100);
  ctx.strokeRect(90,90,100,100);
  ctx.beginPath();
  ctx.moveTo(60,60);ctx.lineTo(90,90);
  ctx.moveTo(160,60);ctx.lineTo(190,90);
  ctx.moveTo(60,160);ctx.lineTo(90,190);
  ctx.moveTo(160,160);ctx.lineTo(190,190);
  ctx.stroke();
  applyCanvas(3);
}

function iconText(){
  ctx.clearRect(0,0,240,240);
  ctx.fillStyle="#fff";
  ctx.font="bold 90px Inter";
  ctx.textAlign="center";
  ctx.textBaseline="middle";
  ctx.fillText("DEV",120,120);
  applyCanvas(3);
}

function scatter(){
  for(let i=0;i<COUNT;i++){
    target[i*3]=(Math.random()-0.5)*10;
    target[i*3+1]=(Math.random()-0.5)*10;
    target[i*3+2]=(Math.random()-0.5)*10;
  }
}

/* ===== SCROLL SYNC ===== */
window.addEventListener("scroll",()=>{
  const t=Math.min(1,scrollY/500);
  camera.position.z=6-1.5*t;
  mat.size=0.045-0.015*t;
});

/* ===== LOOP ===== */
function animate(){
  requestAnimationFrame(animate);
  const p=geo.attributes.position.array;
  for(let i=0;i<p.length;i++){
    p[i]+=(target[i]-p[i])*0.06;
  }
  geo.attributes.position.needsUpdate=true;
  pts.rotation.y+=0.002;
  renderer.render(scene,camera);
}
scatter();
animate();
</script>

</body>
</html>
